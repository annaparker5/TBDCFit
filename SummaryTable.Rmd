---
title: "Summary Table Code"
output: html_notebook
---

This script will make the summary table to include in the manuscript. 

Contents: 

1. % plants with flowers
  - extract which plants had any flowers from final flowering datasheet
2. # flowers / plant
  - take the mean of those with flowers by trt and type
3. % plants with mature pods
  - extract which plants had any pods from final pod datasheet
4. #/mass of seeds / pod
  - take the mean of those by trt and type
5. % seeds germinated
  - take the mean of those who we germinated from by trt and type
6. area of leaves consumed
  - take the mean from final herbivory datasheet

Roadmap: 

0. Load in packages and datasets
1. Make output file
2. Go through 1-6 each in order, adding to an output datafile. 
3. Export output datafile as a csv. 


# 0. Load in our packages and datasets 

```{r}
library(tidyverse)
library(Rmisc)
library(ggplot2)
```

## FIELD: 

```{r}
farea <- read.csv("~/Desktop/GitHub/TBDCFit/Data/FieldLeafArea.csv", header = TRUE)
fgerm <- read.csv("~/Desktop/GitHub/TBDCFit/Data/GermCollated.csv", header = TRUE)
fkey <- read.csv("~/Desktop/GitHub/TBDCFit/Data/pidTrtKey.csv", header = TRUE)
fpods <- read.csv("~/Desktop/GitHub/TBDCFit/Data/ExitData.csv", header = TRUE)
fTBseed <- read.csv("~/Desktop/GitHub/TBDCFit/Data/TBSeed.csv", header = TRUE)
fDCseed <- read.csv("~/Desktop/GitHub/TBDCFit/Data/DCSeed.csv", header = TRUE)
fflowers <- read.csv("~/Desktop/GitHub/TBDCFit/Data/FieldNumFlowers.csv", header = TRUE)
```


# 1. Output file

```{r}
metrics <- c("percentflowers", "numflowers", "percentpods", "numpods", "percentgerm", "leafarea")

foutput <- data.frame(metric = metrics, 
                     N = 0, 
                     DCCONmean = 0, 
                     DCCONse = 0, 
                     DCWANDmean = 0, 
                     DCWANDse = 0,
                     DCWEmean = 0, 
                     DCWEse = 0,
                     DCWOWEmean = 0, 
                     DCWOWEse = 0,
                     TBCONmean = 0, 
                     TBCONse = 0, 
                     TBWANDmean = 0, 
                     TBWANDse = 0,
                     TBWEmean = 0, 
                     TBWEse = 0,
                     TBWOWEmean = 0, 
                     TBWOWEse = 0)
```


# 2. Go through each metric

## Percent flowers

Datafile: output of for loop (fflowers), key (fkey)
Approach: Create binary column, subset by Trt+Type, take number of 1s over total number


get requisite columns in dataframe

```{r}
fkey <- fkey %>%
  select(pid, type, treatment)

fflowers <- merge(fflowers, fkey, by = "pid")

fflowers$binary <- 0

fflowers$composite <- paste(fflowers$type, fflowers$treatment, sep = " ")
```

for loop for binary assignment 

```{r}
for(i in 1:length(fflowers$pid)){
  if(fflowers[i, 2] > 0){
    fflowers[i, 5] <- 1
  } else if(fflowers[i, 2] <= 0){
    fflowers[i, 5] <- 0
  }
}

```

for loop for subsetting and getting percentages

```{r}
fflowperc <- data.frame(composite = unique(fflowers$composite), 
                        perc = 0)

fflowperc <- fflowperc[order(fflowperc$composite), ]

uniquecomp <- fflowperc$composite

for(i in 1:length(uniquecomp)){
  k <- uniquecomp[[i]]
  subset <- fflowers[fflowers$composite == k, ]
  #print(subset)
  fflowperc[fflowperc$composite == k, 2] <- (sum(subset$binary)) / (length(subset$binary))
}
```

Add to output table

```{r}
foutput[1, 2] <- 168

foutput[1, 3] <- fflowperc[1, 2]
foutput[1, 5] <- fflowperc[2, 2]
foutput[1, 7] <- fflowperc[3, 2]
foutput[1, 9] <- fflowperc[4, 2]
foutput[1, 11] <- fflowperc[5, 2]
foutput[1, 13] <- fflowperc[6, 2]
foutput[1, 15] <- fflowperc[7, 2]
foutput[1, 17] <- fflowperc[8, 2]
```

## Number of flowers per plant

Data: output of total flowers (fflowers)
Approach: subset by those that flowered, then summarySE 

```{r}
fflowersyes <- fflowers[fflowers$binary == 1, ]

ftotflow <- summarySE(data = fflowersyes,
                      measurevar = "tot.flowers", 
                      groupvars = "composite")
```

Add to final output 

```{r}
foutput[2, 2] <- sum(ftotflow$N)

foutput[2, 3] <- ftotflow[1, 3]
foutput[2, 4] <- ftotflow[1, 5]
foutput[2, 5] <- ftotflow[2, 3]
foutput[2, 6] <- ftotflow[2, 5]
foutput[2, 7] <- ftotflow[3, 3]
foutput[2, 8] <- ftotflow[3, 5]
foutput[2, 9] <- ftotflow[4, 3]
foutput[2, 10] <- ftotflow[4, 5]
foutput[2, 11] <- ftotflow[5, 3]
foutput[2, 12] <- ftotflow[5, 5]
foutput[2, 13] <- ftotflow[6, 3]
foutput[2, 14] <- ftotflow[6, 5]
foutput[2, 15] <- ftotflow[7, 3]
foutput[2, 16] <- ftotflow[7, 5]
foutput[2, 17] <- ftotflow[8, 3]
foutput[2, 18] <- ftotflow[8, 5]

```




```{r}
write.csv(x = comb, file = "~/Desktop/GitHub/TBDCFit/Data/FieldSeedSummary.csv", row.names = FALSE)
```


