---
title: "figures and Stats for Honors Thesis"
output: html_notebook
---

This notebook will make the figures and run the stats for Tyler's Honors Thesis. 

## 0. Load libraries and data

```{r}
library(tidyverse)
library(ggplot2)
library(lmerTest)
```

```{r}
herb <- read.csv("~/Desktop/GitHub/TBDCFit/Data/HerbivoryCleaned.csv", header = TRUE)
pods <- read.csv("~/Desktop/GitHub/TBDCFit/Data/ExitData.csv", header = TRUE)
TBseed <- read.csv("~/Desktop/GitHub/TBDCFit/Data/TBSeed.csv", header = TRUE)
```

## 1. Clean the data

Remove the individuals that had mature pods that we couldn't measure due to damage/mold

```{r}
TBseed <- TBseed[TBseed$pid != 23, ]
TBseed <- TBseed[TBseed$pid != 141, ]
```

```{r}
pods <- pods[pods$PID != 23, ]
pods <- pods[pods$PID != 141, ]
```

Remove unneeded rows from TBseed and pods

```{r}
TBseed <- TBseed %>%
  select(pid, mature, kept, pod.avg)
```

```{r}
pods <- pods %>%
  select(PID, num.pod.m)
```

Merge datasets into master dataset

```{r}
comb <- merge(herb, pods, by.x = "pid", by.y = "PID")
comb <- merge(comb, TBseed, by = "pid", all.x = TRUE)
```

Get seed resources per pod calculation

Tobacco: mass of each pod
DC: num seeds per pod (avg)

Get total reproductive output

Tobacco: avg mass * num mature pods
DC: avg num seeds * num mature pods

```{r}
comb$repro <- comb$num.pod.m * comb$pod.avg
```

Get zeros in reproductive output with no mature pods

```{r}
comb$repro[is.na(comb$repro)] <- 0
#comb <- mutate_at(comb$repro, ~replace(., is.na(.), 0))
```

Add column to the datatable

```{r}
key <- read.csv("~/Desktop/GitHub/TBDCFit/Data/pidTrtKey.csv", header = TRUE)

key <- key %>%
  select(pid, column)

comb <- merge(comb, key, by = "pid")
```




## 2. Make figures!!

### Fig. 1: Methods Figure

### Fig. 2: Number of leaves consumed across treatment groups

Only individuals that completed development

```{r}
fig2DC <- ggplot(data = comb[comb$type == "DC" & comb$dev.complete == "yes", ], 
                 aes(treatment, num.leaf)) + 
  theme_bw() + 
  geom_boxplot() + 
  geom_jitter(width = 0.1, alpha = 0.5) + 
  labs(x = "Treatment Group", y = "Number of leaves consumed", title = "A) Devil's Claw")

fig2DC
ggsave("~/Desktop/GitHub/TBDCFit/Figures/fig2DC.png", plot = fig2DC, width = 8, height = 5)
```


```{r}
fig2TB <- ggplot(data = comb[comb$type == "TB" & comb$dev.complete == "yes", ], 
                 aes(treatment, num.leaf)) + 
  theme_bw() + 
  geom_boxplot() + 
  geom_jitter(width = 0.1, alpha = 0.5) + 
  labs(x = "Treatment Group", y = "Number of leaves consumed", title = "B) Tobacco")

fig2TB
ggsave("~/Desktop/GitHub/TBDCFit/Figures/fig2TB.png", plot = fig2TB, width = 8, height = 5)
```

### Fig. 3: total realized reproductive output vs. herbivory

```{r}
fig3DCnew
```


```{r}
fig3TBnew <- ggplot(data = comb[comb$type == "TB", ], 
                 aes(x = num.leaf, y = repro/1000, color = treatment)) + 
  theme_bw() + 
  geom_point() + 
  labs(x = "Number of leaves consumed", y = "Total reproductive output (g of seeds)", title = "B) Tobacco", 
       color = "Treatment")

fig3TBnew
ggsave("~/Desktop/GitHub/TBDCFit/Figures/fig3TBnew.png", plot = fig3TBnew, width = 8, height = 5)
```



## Statistics: 

### ANOVA for Fig. 2

```{r}
leafDC <- lmer(num.leaf ~ treatment + (1|column), 
             data = comb[comb$type == "DC" & comb$treatment != "CON" & comb$dev.complete == "yes", ])

summary(leafDC)
```


```{r}
leafTB <- lmer(num.leaf ~ treatment + (1|column), 
             data = comb[comb$type == "TB" & comb$treatment != "CON" & comb$dev.complete == "yes", ])

summary(leafTB)
anova(leafTB)
```

### LM for Fig. 3 new

```{r}
reproTB <- lmer(repro ~ num.leaf + (1|column), data = comb[comb$type == "TB", ])

summary(reproTB)

```

### Checking some stuff

```{r}
reproTB2 <- lmer(repro ~ treatment + (1|column), data = comb[comb$type == "TB", ])

anova(reproTB2)
```

```{r}
columnTB <- lm(repro ~ column, data = comb[comb$type == "TB", ])
#take residuals of this model and have it be the response variable 

anova(columnTB)


combTB <- comb[comb$type == "TB", ]

combTB$residuals <- columnTB$residuals

resid <- lm(residuals ~ num.leaf, data = combTB)

anova(resid)

```

```{r}
ggplot(comb[comb$type == "TB", ], aes(x = column, y = repro)) + 
  geom_boxplot() + 
  geom_jitter(width = 0.1) + 
  ylim(0, 25000)
```




```{r}
checkTB <- lm(repro ~ column*treatment, data = comb[comb$type == "TB", ])

anova(checkTB)
```
DF too high 

